<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 13: Testing with Jest | MAD9124</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="Full-stack: API Development">
    
    <link rel="preload" href="/s2024/assets/css/0.styles.70738741.css" as="style"><link rel="preload" href="/s2024/assets/js/app.40d35fb0.js" as="script"><link rel="preload" href="/s2024/assets/js/2.d13f26af.js" as="script"><link rel="preload" href="/s2024/assets/js/1.f6f71081.js" as="script"><link rel="preload" href="/s2024/assets/js/52.87fc5cdd.js" as="script"><link rel="preload" href="/s2024/assets/js/32.baab7363.js" as="script"><link rel="prefetch" href="/s2024/assets/js/10.700b6097.js"><link rel="prefetch" href="/s2024/assets/js/11.ed8a0934.js"><link rel="prefetch" href="/s2024/assets/js/12.9b4b523d.js"><link rel="prefetch" href="/s2024/assets/js/13.07dd1a9d.js"><link rel="prefetch" href="/s2024/assets/js/14.b96c24af.js"><link rel="prefetch" href="/s2024/assets/js/15.b144383e.js"><link rel="prefetch" href="/s2024/assets/js/16.d16dea2a.js"><link rel="prefetch" href="/s2024/assets/js/17.b4e1a4e8.js"><link rel="prefetch" href="/s2024/assets/js/18.1f2ac466.js"><link rel="prefetch" href="/s2024/assets/js/19.e668708c.js"><link rel="prefetch" href="/s2024/assets/js/20.4f30b3de.js"><link rel="prefetch" href="/s2024/assets/js/21.248f91f3.js"><link rel="prefetch" href="/s2024/assets/js/22.29f49c1a.js"><link rel="prefetch" href="/s2024/assets/js/23.b8ac89c9.js"><link rel="prefetch" href="/s2024/assets/js/24.e2934475.js"><link rel="prefetch" href="/s2024/assets/js/25.fce0b0a1.js"><link rel="prefetch" href="/s2024/assets/js/26.de8d994d.js"><link rel="prefetch" href="/s2024/assets/js/27.c7ef8247.js"><link rel="prefetch" href="/s2024/assets/js/28.75604c91.js"><link rel="prefetch" href="/s2024/assets/js/29.1b506275.js"><link rel="prefetch" href="/s2024/assets/js/3.8c4cc701.js"><link rel="prefetch" href="/s2024/assets/js/30.787c7c10.js"><link rel="prefetch" href="/s2024/assets/js/31.e47a0c3f.js"><link rel="prefetch" href="/s2024/assets/js/33.aa620044.js"><link rel="prefetch" href="/s2024/assets/js/34.81206c0b.js"><link rel="prefetch" href="/s2024/assets/js/35.d62ca566.js"><link rel="prefetch" href="/s2024/assets/js/36.1835e393.js"><link rel="prefetch" href="/s2024/assets/js/37.5098b7b5.js"><link rel="prefetch" href="/s2024/assets/js/38.3ddeba96.js"><link rel="prefetch" href="/s2024/assets/js/39.3f5b8ef9.js"><link rel="prefetch" href="/s2024/assets/js/4.a03d1287.js"><link rel="prefetch" href="/s2024/assets/js/40.b63f2a79.js"><link rel="prefetch" href="/s2024/assets/js/41.5cb461bc.js"><link rel="prefetch" href="/s2024/assets/js/42.fcb0df3f.js"><link rel="prefetch" href="/s2024/assets/js/43.3a92d7d8.js"><link rel="prefetch" href="/s2024/assets/js/44.5c466f1c.js"><link rel="prefetch" href="/s2024/assets/js/45.c7c3dc1a.js"><link rel="prefetch" href="/s2024/assets/js/46.286df3e7.js"><link rel="prefetch" href="/s2024/assets/js/47.8363bb83.js"><link rel="prefetch" href="/s2024/assets/js/48.56c3e93e.js"><link rel="prefetch" href="/s2024/assets/js/49.b0be2d4e.js"><link rel="prefetch" href="/s2024/assets/js/5.ed6c1368.js"><link rel="prefetch" href="/s2024/assets/js/50.b89e2a53.js"><link rel="prefetch" href="/s2024/assets/js/51.7249e197.js"><link rel="prefetch" href="/s2024/assets/js/53.56f24714.js"><link rel="prefetch" href="/s2024/assets/js/54.fae6ee81.js"><link rel="prefetch" href="/s2024/assets/js/55.b1e6a4dd.js"><link rel="prefetch" href="/s2024/assets/js/56.eadf21bf.js"><link rel="prefetch" href="/s2024/assets/js/57.d912e614.js"><link rel="prefetch" href="/s2024/assets/js/6.45d9b7e6.js"><link rel="prefetch" href="/s2024/assets/js/7.017a2e0d.js"><link rel="prefetch" href="/s2024/assets/js/vendors~docsearch.38838867.js">
    <link rel="stylesheet" href="/s2024/assets/css/0.styles.70738741.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/s2024/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/s2024/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/s2024/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/s2024/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/s2024/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/s2024/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/s2024/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/s2024/modules/week01/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/s2024/modules/week02/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/s2024/modules/week03/" class="sidebar-link">Week 3: APIs</a></li><li><a href="/s2024/modules/week04/" class="sidebar-link">Week 4: Project Structure, RESTful alternatives, and Postman</a></li><li><a href="/s2024/modules/week05/" class="sidebar-link">Week 5: Middleware</a></li><li><a href="/s2024/modules/week06/" class="sidebar-link">Week 6: Midterm Project</a></li><li><a href="/s2024/modules/week07/" class="sidebar-link">Week 7: API Integration &amp; Caching</a></li><li><a href="/s2024/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/s2024/modules/week09/" class="sidebar-link">Week 9: Data Persitance and MongoDB</a></li><li><a href="/s2024/modules/week10/" class="sidebar-link">Week 10: Object Data Modelling with Mongoose</a></li><li><a href="/s2024/modules/week11/" class="sidebar-link">Week 11: Data Santization, XSS and LoggingS</a></li><li><a href="/s2024/modules/week12/" class="sidebar-link">Week 12: Authentication With Passport</a></li><li><a href="/s2024/modules/week13/" aria-current="page" class="active sidebar-link">Week 13: Testing with Jest</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#agenda" class="sidebar-link">Agenda</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#testing-with-jest" class="sidebar-link">Testing with Jest</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#matchers" class="sidebar-link">Matchers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#toequal" class="sidebar-link">toEqual</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#tomatchobject" class="sidebar-link">toMatchObject</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#unit-tests" class="sidebar-link">Unit Tests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#mock-functions" class="sidebar-link">Mock Functions</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#arrange" class="sidebar-link">Arrange</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#act" class="sidebar-link">Act</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#assert" class="sidebar-link">Assert</a></li></ul></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#integration-tests" class="sidebar-link">Integration Tests</a></li><li class="sidebar-sub-header"><a href="/s2024/modules/week13/#excerise" class="sidebar-link">Excerise</a></li></ul></li><li><a href="/s2024/modules/week14/" class="sidebar-link">Week 14: Preparing for Production</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 13</span><br> <span class="title">Testing with Jest</span></h1> <h2 id="agenda"><a href="#agenda" class="header-anchor">#</a> Agenda</h2> <ul><li>AMA (10 mins)</li> <li>What is Jest</li> <li>Matchers</li> <li>Unit Tests</li> <li>Integration Tests</li> <li>Exercise</li></ul> <h2 id="testing-with-jest"><a href="#testing-with-jest" class="header-anchor">#</a> Testing with Jest</h2> <p>It is important to test our code, but it can get very tedious, and time consuming to manually test every possible scenario that our application can handle</p> <p>Luckily, we can write tests to automaically test our code for us! We can run a simple command that will test our entire codebase, and let us know if anything isn't working as it should be.</p> <p>We will be using this great library <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to write our test. We can install it as a dev dependency with:</p> <div class="language- extra-class"><pre class="language-text"><code>yarn add -D jest
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">This should be a dev dependency, since tests dont need to be shipped with the production build</p></div> <p>We will next add a script to our package.json file.</p> <div class="language-json extra-class"><pre class="language-json"><code>    ...
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node src/index.js&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// add the following line</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
</code></pre></div><p>Now, when we run <code>yarn test</code>, jest will look for all files with the extension <code>.test.js</code>, and run the tests in those files!</p> <h2 id="matchers"><a href="#matchers" class="header-anchor">#</a> Matchers</h2> <p>The most basic way to use jest is to run a function, then run jest's matcher methods against the result to see if it returns the expected result. Take this example of a function that adds to numbers together:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can test this function with jest by calling the function, and comparing it to the expected result using the following syntax:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;our first test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Great! We've written our first test</p> <p>There are a few more matchers that you should be familiar with, that will help you write your tests:</p> <h3 id="toequal"><a href="#toequal" class="header-anchor">#</a> <code>toEqual</code></h3> <p>The <code>toBe</code> matcher only works for basic types likes strings and nubmers, not for objects or arrays. Luckily, we can use <code>toEqual</code> instead to compare objects!</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">addToObject</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>obj2<span class="token punctuation">,</span> <span class="token operator">...</span>obj1 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;another test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">addToObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">one</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">two</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">one</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">two</span><span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="tomatchobject"><a href="#tomatchobject" class="header-anchor">#</a> <code>toMatchObject</code></h3> <p>Sometimes, we might not know every attribute that will be returned (think mongo ObjectId). We can use <code>toMatchObject</code> to compare only the attributes that we care about easily.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">mockMongoCreate</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">,</span> <span class="token operator">...</span>input <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;another test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">mockMongoCreate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">one</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">one</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr> <h2 id="unit-tests"><a href="#unit-tests" class="header-anchor">#</a> Unit Tests</h2> <p>Unit Tests are small tests that test only the functionallity of one method of our code. If our function uses another part of our code, or an external library, we will replace those methods with fake data (or mocks), so we can focus solely on the method at hand.</p> <p>We will create unit tests to test all of the methods in our StudentService. Lets begin by creating <code>students.test.js</code>. We can add identifiers to the output of our test using the describe function.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;StudentService&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="mock-functions"><a href="#mock-functions" class="header-anchor">#</a> Mock Functions</h3> <p>Jest has a simple method to mock any module / library import in our test. For our StudentService Unit tests, we will want to mock the Student model, because we don't want to actually read or write from mongodb for our tests.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;../models/student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The student model has now been mocked, and now has been replaced with a completely new jest Object. We can tell it what to return with depending on the test, and it will keep track of details such as how many times the function has been called, and what the inputs were.</p> <hr> <p>Lets write our first unit test for the <code>getAll</code> method. We will use the describe method again, along with the <code>it</code> method to tell us exactly what each test is testing for.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;StudentService&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;getAll&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should call Student.find and return the result&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Every test can be broken down into three parts: <code>Arrange</code> , <code>Act</code>, and <code>Assert</code></p> <h3 id="arrange"><a href="#arrange" class="header-anchor">#</a> Arrange</h3> <p>In this step, we will set up any mock funcitons, declare inputs, or other data that will be used throughout the test.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

<span class="token comment">// Arrange</span>
<span class="token keyword">const</span> <span class="token constant">EXPECTED</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;tim&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token string">&quot;A+&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// here we tell our mocked Student model what to return</span>
Student<span class="token punctuation">.</span>find<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token constant">EXPECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="act"><a href="#act" class="header-anchor">#</a> Act</h3> <p>In this step, we call the method we are testing</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

<span class="token comment">// Act</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> StudentService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="assert"><a href="#assert" class="header-anchor">#</a> Assert</h3> <p>In this step, we use the jest matcher methods to assert that the correct behaviour / result has happened.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/services/students.test.js</span>

<span class="token comment">// Assert</span>
<span class="token function">expect</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>find<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token constant">EXPECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Our first test is complete! All together it should look like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;#getAll&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;'should call Student.find and return the result'&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token keyword">const</span> <span class="token constant">EXPECTED</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;tim&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token string">&quot;A+&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    Student<span class="token punctuation">.</span>find<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token constant">EXPECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Act</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> StudentService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Assert</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>find<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Way to go! Now lets try writing a unit test for the <code>getOne</code> method. Notice this method may throw an error, and has an input, so we will have to test all different scenarios.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;getOne&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should call Student.findById&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token comment">// Act</span>
    <span class="token comment">// Assert</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should throw an error if not found&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token comment">// Act</span>
    <span class="token comment">// Assert</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Scenario 1 of our method, we will expect the Student.findById method to be called with the correct id, called exactly once, and to return the result from that method. We can test it with:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Arrange</span>
<span class="token keyword">const</span> _id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> id <span class="token operator">=</span> _id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">EXPECTED</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  _id<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Tim&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token string">&quot;A+&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Student<span class="token punctuation">.</span>findById<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token constant">EXPECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Act</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> StudentService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Assert</span>
<span class="token function">expect</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>findById<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledWith</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>findById<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>calls<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">expect</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token constant">EXPECTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Scenario 2 will be when the error is thrown. We can get to this path by mocking the Student.findById to respond with null. In this case, we will expect our error to throw an error, and we can test for errors like so:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Arrange</span>
<span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Student<span class="token punctuation">.</span>findById<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Act</span>
<span class="token comment">//Assert</span>
<span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>StudentService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">NotFoundError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Student with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not found</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Great! we now have the basics down for Unit tests. We will complete the rest of the tests for the Student Service together in class.</p> <h2 id="integration-tests"><a href="#integration-tests" class="header-anchor">#</a> Integration Tests</h2> <p>Now that we have tested each individual piece of our application, we need to test that it is all connected properly. This is where the integration test comes in. We send a request just as a user would, and we make sure it goes all the way through our app and back to the user with the expected result. To help us with this, we will add another library called <code>supertest</code>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> supertest
</code></pre></div><p>Lets create a new file and folder <code>test/integration/student.test.js</code> so we can keep our tests separate. We can tell jest to only test a certain directory to separate our unit tests from our integration tests. I like to keep the unit tests right next to the file they are testing, and integration tests in their own folder. Lets update our script:</p> <div class="language- extra-class"><pre class="language-text"><code>// package.json
...
&quot;test:unit&quot;: &quot;jest src&quot;,
&quot;test:integration&quot;: &quot;jest test/integration&quot;,
&quot;test&quot;: &quot;yarn test:unit &amp;&amp; yarn test:integration&quot;
</code></pre></div><p>Integration tests take a lot more setup, so lets get started. First, we need to set up a copy of our express app.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dotenv/config&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sanitizeBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../src/middleware/sanitizeBody&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> studentRouter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../src/router/students&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> errorHandler <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../src/utils/errors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/api/students&quot;</span><span class="token punctuation">,</span> sanitizeBody<span class="token punctuation">,</span> studentRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>errorHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Notice our stripped down version of our app, with just the necessities.</p> <p>Next, we will need to connect to our database. Jest has some great helper functions to perform actions before or after tests.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_URL_TEST</span><span class="token operator">?.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid testing url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// this will be run once at the very start, before any tests begin</span>
<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGO_URL_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// this will be run multiple times, once before each test</span>
<span class="token comment">// beforeEach()</span>

<span class="token comment">// this will be run multiple times, once after each test</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> Student<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// this will be run once, after all the tests are finished</span>
<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">It is a good idea to make sure we aren't connected to our remote database, as we will be deleting everything after each test!!</p></div> <p>Lets write our first test! We will start with the <code>GET /</code> request.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;supertest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;Student Resource&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;GET /&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;happy path&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Arrange</span>
      <span class="token comment">// Act</span>
      <span class="token comment">// Assert</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We will need to create multiple students throughout our integration tests, so it will be handy to have a helper function that we can reuse. Lets create that now!</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// test/integration/mocks/student.js</span>
<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Student <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../../../src/models/student&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createStudent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">studentData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newStudent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token string">&quot;A+&quot;</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>studentData<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> newStudent<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// this will recreate the behaviour of sending the data through HTTP</span>
  <span class="token comment">// it will make asserting the data easier later (especially with dates)</span>
  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newStudent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  createStudent<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>We can use this helper function to create a user before we make our request, and we should then expect to get that user back in an array from our application.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Arrange</span>
<span class="token keyword">const</span> createdStudent <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Act</span>
<span class="token comment">// supertest has it's own expect method, we can tell it the expected status code</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/api/students&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Assert</span>
<span class="token function">expect</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>createdStudent<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Our first integration test in the books! Lets test GET /:id next. Remember, it will take in more information, and may return an error!</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;GET /:id&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;happy path&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token keyword">const</span> createdStudent <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">createStudent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Act</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/students/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>createdStudent<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Assert</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span> createdStudent<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should return status 404 for bad request&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Act</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/students/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Assert</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Student with id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> not found</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Supertest can also run request with data. Here is how we might test for the POST / route:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;POST /&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;happy path&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;tim&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token string">&quot;A+&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Act</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/api/students/&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> students <span class="token operator">=</span> <span class="token keyword">await</span> Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> student <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>students<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Assert</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should return status 400 for bad request&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Arrange</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;tim&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Act</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> body <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/api/students&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Assert</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">&quot;student validation failed: grade: Path `grade` is required.&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Way to go! We will complete the rest of the integration tests together in class.</p> <h2 id="excerise"><a href="#excerise" class="header-anchor">#</a> Excerise</h2> <p>Testing with tim. Coming soon!</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/14/2024, 10:09:39 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/s2024/modules/week12/" class="prev">
        Week 12: Authentication With Passport
      </a></span> <span class="next"><a href="/s2024/modules/week14/">
        Week 14: Preparing for Production
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/s2024/assets/js/app.40d35fb0.js" defer></script><script src="/s2024/assets/js/2.d13f26af.js" defer></script><script src="/s2024/assets/js/1.f6f71081.js" defer></script><script src="/s2024/assets/js/52.87fc5cdd.js" defer></script><script src="/s2024/assets/js/32.baab7363.js" defer></script>
  </body>
</html>
